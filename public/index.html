<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutriway ‚Äî Admin & FastDiet Edition</title>
    
    <!-- Tailwind CSS Config for Dark Mode -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#111827', // gray-900
                            card: '#1f2937', // gray-800
                            input: '#374151', // gray-700
                        }
                    }
                }
            }
        }
    </script>

    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&family=Roboto:wght=400;700&family=Open+Sans&family=Oswald&family=Pacifico&family=Lobster&family=Amatic+SC&family=Merriweather&family=Comfortaa&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Play&family=Inter&family=Poppins&family=Lato&family=Nunito&family=Raleway&family=Ubuntu&family=DM+Sans&family=Manrope&family=Bebas+Neue&family=Anton&family=Playfair+Display&family=Cinzel&family=Dancing+Script&family=Great+Vibes&family=Indie+Flower&family=JetBrains+Mono&family=Fira+Code&display=swap" rel="stylesheet">

    <style>
        /* --- 1. –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü --- */
        :root {
            --primary: #10b981;
            --secondary: #3b82f6;
            --site-color-top: #059669;
            --site-color-bot: #2563eb;
            --site-gradient-angle: 135deg;
            --site-gradient: linear-gradient(var(--site-gradient-angle), var(--site-color-top) 0%, var(--site-color-bot) 100%);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            scroll-behavior: smooth;
            overflow-x: hidden;
            /* –ë–∞–∑–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç—ñ –∑–º—ñ–Ω–∏ —Ç–µ–º–∏ */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* –ö–ª–∞—Å –¥–ª—è –≥—Ä–∞–¥—ñ—î–Ω—Ç—ñ–≤ */
        .hero-gradient-bg {
            background: var(--site-gradient) !important;
        }

        /* --- 2. –°–¢–ò–õ–Ü –ê–ù–Ü–ú–ê–¶–Ü–ô --- */
        #mobile-menu {
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            transform: translateX(100%);
            box-shadow: -10px 0 30px rgba(0,0,0,0.1);
        }
        #mobile-menu.active { transform: translateX(0); }

        .menu-item { opacity: 0; transform: translateX(30px); transition: all 0.5s ease; }
        #mobile-menu.active .menu-item { opacity: 1; transform: translateX(0); }
        .delay-1 { transition-delay: 0.1s; }
        .delay-2 { transition-delay: 0.2s; }
        .delay-3 { transition-delay: 0.3s; }
        .delay-4 { transition-delay: 0.4s; }

        #menu-overlay {
            display: none; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px);
            position: fixed; inset: 0; z-index: 40;
        }
        #menu-overlay.active { display: block; }

        .page-content { display: none; animation: fadeIn 0.4s ease-out; }
        .page-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        .info-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .info-card:hover { transform: translateY(-10px); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1); }

        /* --- 3. –°–¢–ò–õ–Ü –ê–î–ú–Ü–ù–ö–ò --- */
        .movable-box {
            position: absolute; display: inline-block; cursor: grab;
            border: 1px dashed transparent; min-width: 50px; min-height: 50px; 
            z-index: 9000; /* –ó–±—ñ–ª—å—à–µ–Ω–∏–π z-index –¥–ª—è –ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –ø–ª–∞–Ω—É */
        }
        .movable-box.selected-element, .card.selected-element, .selected-element, .selected-text {
            outline: 2px dashed #ffeb3b !important; outline-offset: 2px; 
            z-index: 9001; /* –©–µ –≤–∏—â–∏–π z-index –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ */
        }
        .movable-content { width: 100%; height: 100%; overflow: hidden; }
        .resize-handle {
            width: 15px; height: 15px; background: white; border: 2px solid var(--primary);
            position: absolute; right: -7px; bottom: -7px; cursor: se-resize;
            display: none; 
            z-index: 9002; /* –í–∏—â–µ –Ω—ñ–∂ selected element */
        }
        .movable-box.selected-element .resize-handle { display: block; }

        #admin-panel {
            position: fixed; top: 0; right: -360px;
            width: 340px; height: 100vh;
            background: rgba(44, 62, 80, 0.98); 
            color: #ecf0f1; padding: 20px; 
            box-shadow: -5px 0 20px rgba(0,0,0,0.5);
            z-index: 9999; transition: right 0.4s ease;
            overflow-y: auto; font-family: 'Roboto', sans-serif;
        }
        #admin-panel.active { right: 0; }
        
        .admin-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn-history { flex: 1; text-align: center; font-size: 1.2em; padding: 8px; background: #e67e22; border: none; border-radius: 5px; cursor: pointer; color: white; }
        .btn-tool { 
            background: #34495e; color: white; border: 1px solid #5d6d7e; 
            cursor: pointer; padding: 10px; margin-top: 5px; width: 100%; 
            text-align: left; border-radius: 5px; transition: 0.2s;
        }
        .btn-tool:hover { background: #415b76; transform: translateX(5px); }
        .admin-label { color: #bdc3c7; font-size: 0.8em; text-transform: uppercase; margin-top: 15px; display: block; }
        
        #admin-panel input[type="color"], #admin-panel input[type="number"], #admin-panel select, #admin-panel input[type="text"] {
            width: 100%; height: 35px; margin-top: 5px; border-radius: 4px; border: none; padding: 0 10px; color: #333;
        }

        #style-controls { opacity: 0.3; pointer-events: none; margin-top: 20px; border-top: 1px solid #555; padding-top: 10px;}
        #style-controls.active { opacity: 1; pointer-events: auto; }
        #card-style-controls, #hero-style-controls { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #444; }
        
        /* --- –ö–ê–†–¢–ö–ò --- */
        .card {
            --card-color-top: #667eea;
            --card-color-bot: #764ba2;
            background: linear-gradient(135deg, var(--card-color-top) 0%, var(--card-color-bot) 100%);
            width: 100%;
            max-width: 320px; 
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            overflow: hidden;
            color: white;
            transition: transform 0.3s ease;
            text-align: center;
            padding-bottom: 20px;
            margin: 10px;
        }
        .card:hover { transform: translateY(-5px); }
        .card-image {
            width: 100%; height: 200px; object-fit: cover;
            background-color: #ddd; pointer-events: none; 
        }
        .card-content h2 { margin: 15px 0 5px; font-size: 1.5em; }
        .card-content p { padding: 0 15px; opacity: 0.9; font-size: 0.95em; }

        /* HERO BANNER */
        .hero-banner-style {
            --hero-bg-top: #42a5f5;
            --hero-bg-bot: #26a69a;
            background: linear-gradient(90deg, var(--hero-bg-top), var(--hero-bg-bot));
            width: 100%; height: 100%;
            border-radius: 20px;
            position: relative;
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center;
            color: white; text-align: center;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.2), 0 5px 15px rgba(0,0,0,0.1); 
            padding: 20px;
            overflow: hidden;
            z-index: 9000;
        }
        .hero-banner-img {
            width: 100%; max-height: 150px; object-fit: cover; 
            border-radius: 10px; margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .hero-banner-style h2, .hero-banner-style p {
            position: relative; z-index: 2; text-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .hero-banner-style::after {
            content: ''; position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 1px solid rgba(255,255,255,0.4); border-radius: 15px; pointer-events: none;
            z-index: 9000;
        }

        /* --- –í–Ü–¢–ê–ú–Ü–ù–ò (—ñ–∑ –≤—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏) --- */
        .vit-item {
            display: flex; align-items: center; padding: 1rem;
            border-radius: 1rem;
            gap: 1rem; transition: transform 0.2s;
        }
        .vit-item:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .vit-icon-box { font-size: 1.5rem; width: 3rem; text-align: center; }
        #disclaimer-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            display: flex; justify-content: center; align-items: center;
        }
        .disclaimer-box {
            background: rgb(47, 40, 40); padding: 30px; border-radius: 15px;
            max-width: 500px; text-align: center;
            box-shadow: 0 0 30px rgba(8, 169, 161, 0.3);
            animation: popIn 0.5s ease;
        }
        .disclaimer-btn {
            background: var(--primary); color: white;
            border: none; padding: 12px 30px; font-size: 18px;
            border-radius: 30px; cursor: pointer; margin-top: 20px;
            font-weight: bold; transition: 0.3s;
        }
        .disclaimer-btn:hover { transform: scale(1.05); background: #a09417; }
        /* --- –ö—Ä–∞–ø–ª—è --- */
        .water-drop {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #00C6FF, #0072FF);
            /* –ú–∞–≥—ñ—è —Ñ–æ—Ä–º–∏: 0% –∑ –æ–¥–Ω–æ–≥–æ –∫—É—Ç–∞, 50% –∑ —ñ–Ω—à–∏—Ö */
            border-radius: 0 50% 50% 50%; 
            /* –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ, —â–æ–± –≥–æ—Å—Ç—Ä–∏–π –∫—É—Ç –±—É–≤ –∑–≤–µ—Ä—Ö—É */
            transform: rotate(45deg);
            margin: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* --- –°–∫–ª—è–Ω–∫–∞ --- */
        .water-glass {
            width: 40px;
            height: 50px;
            border: 3px solid #333;
            border-top: none; /* –í—ñ–¥–∫—Ä–∏—Ç–∏–π –≤–µ—Ä—Ö */
            border-radius: 0 0 10px 10px; /* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–µ –¥–Ω–æ */
            position: relative;
            overflow: hidden; /* –©–æ–± –≤–æ–¥–∞ –Ω–µ –≤–∏—Ç—ñ–∫–∞–ª–∞ –∑–∞ –º–µ–∂—ñ */
            margin: 20px;
        }

        /* –í–æ–¥–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ */
        .liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 70%; /* –†—ñ–≤–µ–Ω—å –≤–æ–¥–∏ */
            background: linear-gradient(to top, #00C6FF, #0072FF);
            opacity: 0.8;
        }
        /* –ú—ñ–Ω—ñ-—Å–∫–ª—è–Ω–∫–∞ –¥–ª—è —ñ–∫–æ–Ω–∫–∏ */
        .mini-glass {
            width: 32px;
            height: 40px;
            border: 3px solid #3b82f6; /* –ö–æ–ª—ñ—Ä Blue-500 */
            border-top: none; /* –í–µ—Ä—Ö –≤—ñ–¥–∫—Ä–∏—Ç–∏–π */
            border-radius: 0 0 10px 10px; /* –ó–∞–∫—Ä—É–≥–ª–µ–Ω–µ –¥–Ω–æ */
            position: relative;
            overflow: hidden;
            background-color: rgba(255, 255, 255, 0.1); /* –õ–µ–≥–∫–∏–π —Ñ–æ–Ω —Å–∫–ª–∞ */
        }

        /* –í–æ–¥–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ */
        .liquid-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60%; /* –†—ñ–≤–µ–Ω—å –≤–æ–¥–∏ */
            background: linear-gradient(to top, #60a5fa, #3b82f6); /* –ì—Ä–∞–¥—ñ—î–Ω—Ç –≤–æ–¥–∏ */
            opacity: 0.9;
            
            /* –î–æ–¥–∞–º–æ –ª–µ–≥–∫—É –∞–Ω—ñ–º–∞—Ü—ñ—é */
            animation: slosh 3s infinite ease-in-out;
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –∫–æ–ª–∏–≤–∞–Ω–Ω—è –≤–æ–¥–∏ */
        @keyframes slosh {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(2px) rotate(2deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen transition-colors duration-300 dark:bg-gray-900 dark:text-gray-100">

    <div id="disclaimer-overlay">
        <div class="disclaimer-box">
            <h1 style="color: rgb(212, 55, 55);">–£–í–ê–ì–ê!</h1>
            <p style="margin: 15px 0; color: hsla(0, 76%, 60%, 0.725);">–í—Å—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, —Ä–æ–∑–º—ñ—â–µ–Ω–∞ –Ω–∞ –¥–∞–Ω–æ–º—É —Å–∞–π—Ç—ñ, –Ω–∞–¥–∞—î—Ç—å—Å—è –≤–∏–∫–ª—é—á–Ω–æ –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–æ—é —Ç–∞ –æ–∑–Ω–∞–π–æ–º—á–æ—é –º–µ—Ç–æ—é. –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ —Å–∞–π—Ç—É –Ω–µ —î –º–µ–¥–∏—á–Ω–æ—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—î—é, –Ω–µ —î –¥—ñ–∞–≥–Ω–æ–∑–æ–º, –Ω–µ —î —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—î—é –¥–æ –ª—ñ–∫—É–≤–∞–Ω–Ω—è, –Ω–µ —î —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–º –ø–ª–∞–Ω–æ–º —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è —Ç–∞ –Ω–µ –º–æ–∂—É—Ç—å –∑–∞–º—ñ–Ω–∏—Ç–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é –ª—ñ–∫–∞—Ä—è, –¥—ñ—î—Ç–æ–ª–æ–≥–∞ –∞–±–æ —ñ–Ω—à–æ–≥–æ –∫–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ–≥–æ —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç–∞.</p>
            <p style="margin: 15px 0; color: hsla(0, 76%, 60%, 0.725);">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—è —Å–∞–π—Ç—É –Ω–µ –Ω–µ—Å–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ –∑–∞ –±—É–¥—å-—è–∫—ñ –Ω–∞—Å–ª—ñ–¥–∫–∏, –ø—Ä—è–º—ñ –∞–±–æ –Ω–µ–ø—Ä—è–º—ñ, —â–æ –º–æ–∂—É—Ç—å –≤–∏–Ω–∏–∫–Ω—É—Ç–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ —Ü—å–æ–≥–æ —Å–∞–π—Ç—É, –≤–∫–ª—é—á–Ω–æ (–∞–ª–µ –Ω–µ –æ–±–º–µ–∂—É—é—á–∏—Å—å): –∑–º—ñ–Ω–∞–º–∏ —Å—Ç–∞–Ω—É –∑–¥–æ—Ä–æ–≤‚Äô—è, –ø–æ–≥—ñ—Ä—à–µ–Ω–Ω—è–º —Å–∞–º–æ–ø–æ—á—É—Ç—Ç—è, –∞–ª–µ—Ä–≥—ñ—á–Ω–∏–º–∏ —Ä–µ–∞–∫—Ü—ñ—è–º–∏, –≥–æ—Ä–º–æ–Ω–∞–ª—å–Ω–∏–º–∏ –ø–æ—Ä—É—à–µ–Ω–Ω—è–º–∏, –ø—Ä–æ–±–ª–µ–º–∞–º–∏ –∑ —Ç—Ä–∞–≤–ª–µ–Ω–Ω—è–º –∞–±–æ —ñ–Ω—à–∏–º–∏ —Ñ—ñ–∑–∏—á–Ω–∏–º–∏ —á–∏ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—á–Ω–∏–º–∏ –Ω–∞—Å–ª—ñ–¥–∫–∞–º–∏.</p>
            <button class="disclaimer-btn" onclick="closeDisclaimer()">–Ø –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—é —É—Å–µ</button>
        </div>
    </div>


    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ—è -->
    <nav class="fixed top-0 left-0 right-0 z-[60] bg-white/90 backdrop-blur-md border-b border-gray-100 transition-colors duration-300 dark:bg-gray-900/90 dark:border-gray-800">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2 cursor-pointer" onclick="showPage('home')">
                <i class="fas fa-route text-green-500 text-2xl"></i>
                <span class="text-xl font-bold tracking-tight text-gray-900 dark:text-white">Nutri<span class="text-green-500">way</span></span>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- –ö–ù–û–ü–ö–ê –ó–ú–Ü–ù–ò –¢–ï–ú–ò -->
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-yellow-400 transition transform hover:scale-110" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">
                    <i class="fas fa-moon text-xl"></i>
                </button>

                <button onclick="toggleMenu()" class="p-2 focus:outline-none text-gray-900 dark:text-white hover:text-green-500 transition">
                    <i id="menu-icon" class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Overlay -->
    <div id="menu-overlay" onclick="toggleMenu()"></div>

    <!-- –ë—É—Ä–≥–µ—Ä –ú–µ–Ω—é -->
    <div id="mobile-menu" class="fixed top-0 right-0 h-full z-50 bg-white dark:bg-gray-800 w-full sm:w-1/2 lg:w-1/4 flex flex-col p-8 pt-24 shadow-2xl">
        <div class="flex flex-col space-y-6 text-lg font-semibold text-gray-800 dark:text-gray-100">
            <a href="javascript:void(0)" onclick="showPage('home'); toggleMenu();" class="menu-item delay-1 hover:text-green-500 flex items-center space-x-4">
                <i class="fas fa-home w-6"></i> <span>–ì–æ–ª–æ–≤–Ω–∞</span>
            </a>
            <a href="javascript:void(0)" onclick="showPage('calculator'); toggleMenu();" class="menu-item delay-2 hover:text-green-500 flex items-center space-x-4">
                <i class="fas fa-calculator w-6"></i> <span>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
            </a>
            <a href="javascript:void(0)" onclick="openAdminAuth(); toggleMenu();" class="menu-item delay-3 hover:text-red-500 flex items-center space-x-4 border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                <i class="fas fa-cogs w-6"></i> <span>–ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å</span>
            </a>
        </div>
    </div>

    <!-- MAIN CONTENT AREA -->
    <div id="content-area">

        <!-- –ì–û–õ–û–í–ù–ê –°–¢–û–†–Ü–ù–ö–ê -->
        <main id="home-page" class="page-content active pt-16">
            <!-- Hero Section -->
            <header class="hero-gradient-bg text-white py-24 px-4 text-center relative overflow-hidden">
                <div class="container mx-auto relative z-10">
                    <h1 class="text-4xl md:text-6xl font-black mb-6 editable-text drop-shadow-md">Nutriway</h1>
                    <p class="text-lg opacity-90 mb-10 max-w-2xl mx-auto italic editable-text drop-shadow-sm">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —à–ª—è—Ö –¥–æ –∑–¥–æ—Ä–æ–≤'—è —Ç–∞ —ñ–¥–µ–∞–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏.</p>
                    <div class="flex justify-center gap-4">
                        <button onclick="showPage('calculator')" class="bg-white text-blue-600 px-8 py-3 rounded-full font-bold hover:shadow-xl transition hover:scale-105">–ü–æ—á–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫</button>
                    </div>
                </div>
            </header>

            <!-- –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -->
            <section class="py-20 container mx-auto px-4">
                <h2 class="text-3xl font-bold mb-12 text-center editable-text dark:text-white">–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h2>
                <div id="diag-grid" class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-24 text-center">
                    <!-- Cards with Dark Mode Support -->
                    <div class="p-6 bg-white dark:bg-gray-800 dark:border-gray-700 rounded-3xl shadow-md border border-gray-100 info-card transition-colors duration-300">
                        <i class="fas fa-heartbeat text-red-500 text-3xl mb-4"></i>
                        <h3 class="font-bold mb-2 editable-text dark:text-white">–Ü–ú–¢</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 editable-text">–û—Ü—ñ–Ω–∫–∞ –º–∞—Å–∏ —Ç—ñ–ª–∞.</p>
                    </div>
                    <div class="p-6 bg-white dark:bg-gray-800 dark:border-gray-700 rounded-3xl shadow-md border border-gray-100 info-card transition-colors duration-300">
                        <i class="fas fa-fire text-orange-500 text-3xl mb-4"></i>
                        <h3 class="font-bold mb-2 editable-text dark:text-white">–ö–∞–ª–æ—Ä—ñ—ó</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 editable-text">–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –Ω–æ—Ä–º–∏.</p>
                    </div>
                    <div class="p-6 bg-white dark:bg-gray-800 dark:border-gray-700 rounded-3xl shadow-md border border-gray-100 info-card transition-colors duration-300">
                        <i class="fas fa-pills text-purple-500 text-3xl mb-4"></i>
                        <h3 class="font-bold mb-2 editable-text dark:text-white">–í—ñ—Ç–∞–º—ñ–Ω–∏</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 editable-text">–ü—ñ–¥–±—ñ—Ä –Ω—É—Ç—Ä—ñ—î–Ω—Ç—ñ–≤.</p>
                    </div>
                    <div class="p-6 bg-white dark:bg-gray-800 dark:border-gray-700 rounded-3xl shadow-md border border-gray-100 info-card transition-colors duration-300">
                        <i class="fas fa-bed text-blue-500 text-3xl mb-4"></i>
                        <h3 class="font-bold mb-2 editable-text dark:text-white">–°–æ–Ω</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 editable-text">–ù–æ—Ä–º–∏ –≤—ñ–¥–ø–æ—á–∏–Ω–∫—É.</p>
                    </div>
                </div>

                <!-- –°–í–Ü–¢ NUTRIWAY -->
                <div class="space-y-24">
                    <div class="max-w-4xl mx-auto text-center">
                        <h2 class="text-4xl font-black text-gray-900 dark:text-white mb-4 editable-text">–°–≤—ñ—Ç Nutriway</h2>
                        <p class="text-gray-500 dark:text-gray-400 text-lg editable-text">–ì–ª–∏–±–æ–∫–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –≤–∞—à–æ–≥–æ —Ç—ñ–ª–∞.</p>
                    </div>

                    <div class="grid lg:grid-cols-2 gap-8 items-stretch">
                        <div class="info-card bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 p-8 md:p-12 rounded-[3rem] shadow-sm flex flex-col md:flex-row gap-8 items-center transition-colors duration-300">
                            <div class="w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-3xl flex items-center justify-center shrink-0">
                                <i class="fas fa-seedling text-green-600 dark:text-green-400 text-4xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold mb-3 editable-text dark:text-white">–ù—É—Ç—Ä–∏—Ü—ñ–æ–ª–æ–≥—ñ—è</h3>
                                <p class="text-gray-600 dark:text-gray-300 leading-relaxed text-sm editable-text">–ú–∏ –≤–∏–≤—á–∞—î–º–æ, —è–∫ –∫–æ–∂–µ–Ω –Ω—É—Ç—Ä—ñ—î–Ω—Ç –≤–ø–ª–∏–≤–∞—î –Ω–∞ –µ–Ω–µ—Ä–≥—ñ—é.</p>
                            </div>
                        </div>

                        <div class="info-card bg-gray-900 dark:bg-black p-8 md:p-12 rounded-[3rem] text-white shadow-xl flex flex-col md:flex-row gap-8 items-center border border-transparent dark:border-gray-800">
                            <div class="w-24 h-24 bg-white/10 rounded-3xl flex items-center justify-center shrink-0">
                                <i class="fas fa-utensils text-green-400 text-4xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold mb-3 editable-text">–†–æ–∑—É–º–Ω–∞ –î—ñ—î—Ç–∞</h3>
                                <p class="text-gray-300 leading-relaxed text-sm editable-text">–ü—Ä–∞–≤–∏–ª–æ 80/20: 80% –∫–æ—Ä–∏—Å–Ω–æ—ó —ó–∂—ñ —Ç–∞ 20% –¥–ª—è –¥—É—à—ñ.</p>
                            </div>
                        </div>
                    </div>

                     <!-- –¢–∞—Ä—ñ–ª–∫–∞ –∑–¥–æ—Ä–æ–≤'—è -->
                    <div class="info-card bg-blue-50 dark:bg-blue-900/20 p-8 md:p-12 rounded-[3rem] border border-blue-100 dark:border-blue-900/30 shadow-sm flex flex-col md:flex-row gap-12 items-center transition-colors duration-300">
                        <div class="relative w-48 h-48 shrink-0">
                            <div class="w-full h-full border-8 border-gray-200 dark:border-gray-700 rounded-full flex items-center justify-center bg-white dark:bg-gray-800">
                                <i class="fas fa-circle-notch text-blue-500 text-4xl animate-spin-slow"></i>
                            </div>
                            <div class="absolute top-0 left-0 w-full h-full flex items-center justify-center flex-col text-center">
                                <span class="text-2xl font-black text-blue-900 dark:text-blue-300 italic">50%</span>
                                <span class="text-[10px] font-bold text-blue-400 uppercase">–û–≤–æ—á—ñ</span>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-2xl font-bold mb-4 text-blue-900 dark:text-blue-200 uppercase tracking-tight editable-text">–ü—Ä–∞–≤–∏–ª–æ —Ç–∞—Ä—ñ–ª–∫–∏</h3>
                            <p class="text-blue-800/70 dark:text-blue-200/70 leading-relaxed text-sm mb-6 editable-text">–î—ñ–ª—ñ—Ç—å —Ç–∞—Ä—ñ–ª–∫—É: 50% ‚Äî –æ–≤–æ—á—ñ, 25% ‚Äî –±—ñ–ª–æ–∫, 25% ‚Äî –≤—É–≥–ª–µ–≤–æ–¥–∏.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- –ö–ê–õ–¨–ö–£–õ–Ø–¢–û–† -->
        <main id="calculator-page" class="page-content pt-32 pb-20">
            <div class="container mx-auto px-4 max-w-5xl">
                <h2 class="text-4xl font-black text-center mb-12 editable-text dark:text-white">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>
                
                <div class="grid lg:grid-cols-1 gap-8">
                    <!-- INPUT FORM -->
                    <div class="bg-white dark:bg-gray-800 rounded-[2rem] p-8 shadow-xl border border-gray-100 dark:border-gray-700 max-w-3xl mx-auto w-full transition-colors duration-300">
                        <h3 class="font-bold text-gray-900 dark:text-white mb-6 flex items-center text-xl">
                            <i class="fas fa-user-edit mr-3 text-green-500"></i> –í–∞—à—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
                        </h3>
                        
                        <div class="grid md:grid-cols-3 gap-6 mb-6">
                            <div>
                                <label class="text-xs font-bold text-gray-400 mb-2 block ml-1">–í–Ü–ö (—Ä–æ–∫—ñ–≤)</label>
                                <input id="age" type="number" placeholder="25" class="w-full p-4 bg-gray-50 dark:bg-gray-700 dark:text-white rounded-2xl outline-none focus:ring-2 focus:ring-green-400 transition">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-400 mb-2 block ml-1">–ó–†–Ü–°–¢ (—Å–º)</label>
                                <input id="height" type="number" placeholder="175" class="w-full p-4 bg-gray-50 dark:bg-gray-700 dark:text-white rounded-2xl outline-none focus:ring-2 focus:ring-green-400 transition">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-400 mb-2 block ml-1">–í–ê–ì–ê (–∫–≥)</label>
                                <input id="weight" type="number" placeholder="70" class="w-full p-4 bg-gray-50 dark:bg-gray-700 dark:text-white rounded-2xl outline-none focus:ring-2 focus:ring-green-400 transition">
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="text-xs font-bold text-gray-400 mb-2 block ml-1">–ê–õ–ï–†–ì–Ü–á</label>
                                <input id="allergy" type="text" placeholder="–ì–æ—Ä—ñ—Ö–∏, –º–µ–¥..." class="w-full p-4 bg-gray-50 dark:bg-gray-700 dark:text-white rounded-2xl outline-none focus:ring-2 focus:ring-green-400 transition">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-400 mb-2 block ml-1">–ó–î–û–†–û–í'–Ø</label>
                                <input id="health" type="text" placeholder="–¢—Ä–∞–≤–º–∏..." class="w-full p-4 bg-gray-50 dark:bg-gray-700 dark:text-white rounded-2xl outline-none focus:ring-2 focus:ring-green-400 transition">
                            </div>
                        </div>

                        <div class="mb-6">
                            <label class="text-xs font-bold text-gray-400 mb-2 block ml-1">–°–¢–ê–¢–¨</label>
                            <div class="flex gap-4">
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="gender" value="male" checked class="peer hidden">
                                    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-gray-300 text-center border-2 border-transparent peer-checked:border-green-500 peer-checked:bg-green-50 dark:peer-checked:bg-green-900/30 peer-checked:text-green-700 dark:peer-checked:text-green-400 transition font-bold text-sm">–ß–æ–ª–æ–≤—ñ–∫</div>
                                </label>
                                <label class="flex-1 cursor-pointer">
                                    <input type="radio" name="gender" value="female" class="peer hidden">
                                    <div class="p-3 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-gray-300 text-center border-2 border-transparent peer-checked:border-green-500 peer-checked:bg-green-50 dark:peer-checked:bg-green-900/30 peer-checked:text-green-700 dark:peer-checked:text-green-400 transition font-bold text-sm">–ñ—ñ–Ω–∫–∞</div>
                                </label>
                            </div>
                        </div>

                        <div class="mb-8">
                            <label class="text-xs font-bold text-gray-400 mb-2 block ml-1">–ê–ö–¢–ò–í–ù–Ü–°–¢–¨</label>
                            <div class="grid grid-cols-3 sm:grid-cols-5 gap-2">
                                <!-- Reusable Radio Class -->
                                <label class="cursor-pointer">
                                    <input type="radio" name="activity" value="low" class="peer hidden">
                                    <div class="p-2 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-300 text-center text-xs font-bold border dark:border-gray-600 peer-checked:bg-green-500 peer-checked:text-white transition">–ù–∏–∑—å–∫–∞</div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="activity" value="small" class="peer hidden">
                                    <div class="p-2 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-300 text-center text-xs font-bold border dark:border-gray-600 peer-checked:bg-green-500 peer-checked:text-white transition">–ú–∞–ª–∞</div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="activity" value="medium" checked class="peer hidden">
                                    <div class="p-2 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-300 text-center text-xs font-bold border dark:border-gray-600 peer-checked:bg-green-500 peer-checked:text-white transition">–°–µ—Ä–µ–¥–Ω—è</div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="activity" value="high" class="peer hidden">
                                    <div class="p-2 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-300 text-center text-xs font-bold border dark:border-gray-600 peer-checked:bg-green-500 peer-checked:text-white transition">–í–∏—Å–æ–∫–∞</div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="activity" value="very_high" class="peer hidden">
                                    <div class="p-2 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-gray-300 text-center text-xs font-bold border dark:border-gray-600 peer-checked:bg-green-500 peer-checked:text-white transition">–°–ø–æ—Ä—Ç</div>
                                </label>
                            </div>
                        </div>

                        <button onclick="showData()" class="w-full py-4 bg-gradient-to-r from-blue-500 to-green-500 text-white font-bold rounded-2xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition transform">
                            –†–û–ó–†–ê–•–£–í–ê–¢–ò
                        </button>
                        
                        <!-- Confirmation Buttons -->
                        <div id="confirm-buttons" class="hidden mt-4 flex gap-4">
                             <button onclick="clearResult(); showData();" class="flex-1 py-3 bg-green-500 text-white rounded-xl font-bold hover:bg-green-600">–î–∞–Ω—ñ –≤—ñ—Ä–Ω—ñ</button>
                             <button onclick="reTry()" class="flex-1 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600">–í–∏–ø—Ä–∞–≤–∏—Ç–∏</button>
                        </div>
                    </div>

                    <!-- RESULTS AREA -->
                    <div id="resultArea" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-8 max-w-3xl mx-auto w-full">
                        
                        <!-- Main Stats -->
                        <div id="macros-section" class="bg-white dark:bg-gray-800 rounded-[2rem] p-8 border border-gray-100 dark:border-gray-700 shadow-xl hidden transition-colors duration-300">
                            <h4 class="font-bold text-gray-900 dark:text-white mb-6 flex items-center text-xl">
                                <i class="fas fa-chart-pie mr-3 text-blue-500"></i> –û—Å–Ω–æ–≤–Ω—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏
                            </h4>
                            <div id="macros-grid-container" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <!-- Macros injected by JS -->
                            </div>
                            
                            <!-- IMT & Text Info -->
                            <div class="mt-6 p-6 bg-gray-50 dark:bg-gray-700/50 rounded-2xl border border-gray-200 dark:border-gray-600">
                                <div id="imt-display">
                                    <!-- IMT will be injected here -->
                                </div>
                                <div id="text-info" class="mt-4 text-sm text-gray-600 dark:text-gray-300 whitespace-pre-wrap leading-relaxed"></div>
                            </div>
                        </div>

                        <!-- Sleep Card -->
                        <div id="sleep-section" class="bg-white dark:bg-gray-800 rounded-[2rem] p-8 border border-gray-100 dark:border-gray-700 shadow-xl hidden transition-colors duration-300">
                            <h4 class="font-bold text-gray-900 dark:text-white mb-6 flex items-center text-xl">
                                <i class="fas fa-bed mr-3 text-indigo-500"></i> –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π —Å–æ–Ω
                            </h4>
                            <div class="flex items-center p-4 bg-indigo-50 dark:bg-indigo-900/20 rounded-2xl border border-indigo-100 dark:border-indigo-800">
                                <div class="text-3xl text-indigo-500 mr-4"><i class="fas fa-moon"></i></div>
                                <div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400 font-bold uppercase">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</div>
                                    <div id="sleep-value" class="text-xl font-bold text-gray-900 dark:text-white"></div>
                                </div>
                            </div>
                        </div>
                        <!-- Water Card -->
                        <div id="water-section" class="bg-white dark:bg-gray-800 rounded-[2rem] p-8 border border-gray-100 dark:border-gray-700 shadow-xl hidden transition-colors duration-300">
    
                            <h4 class="font-bold text-gray-900 dark:text-white mb-6 flex items-center text-xl">
                                <i class="fas fa-tint mr-3 text-blue-500 text-2xl"></i> 
                                –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–æ–¥–∏
                            </h4>

                            <div class="flex items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-2xl border border-blue-100 dark:border-blue-800">
                                
                                <div class="mini-glass mr-4">
                                    <div class="liquid-fill"></div>
                                </div>

                                <div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400 font-bold uppercase">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</div>
                                    <div id="water-value" class="text-xl font-bold text-gray-900 dark:text-white"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Vitamin Cards -->
                        <div id="vitamin-section" class="bg-white dark:bg-gray-800 rounded-[2rem] p-8 border border-gray-100 dark:border-gray-700 shadow-xl hidden transition-colors duration-300">
                            <h4 class="font-bold text-gray-900 dark:text-white mb-6 flex items-center text-xl">
                                <i class="fas fa-capsules mr-3 text-purple-500"></i> –í–∞—à–∞ –≤—ñ—Ç–∞–º—ñ–Ω–Ω–∞ –∫–∞—Ä—Ç–∞
                            </h4>
                            <div id="vitamin-grid-container" class="grid md:grid-cols-2 gap-4">
                                <!-- Cards injected by JS -->
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </main>

    </div>

    <!-- ADMIN PANEL -->
    <div id="admin-panel">
        <h3 class="text-xl font-bold mb-4 border-b border-gray-600 pb-2">‚öôÔ∏è –ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å</h3>
        <div class="admin-row">
            <button class="btn-history" id="btn-undo" title="Undo"><i class="fas fa-undo"></i></button>
            <button class="btn-history" id="btn-redo" title="Redo"><i class="fas fa-redo"></i></button>
        </div>
        <div id="site-style-controls">
            <span class="admin-label text-blue-400">üé® –°—Ç–∏–ª—ñ –°–∞–π—Ç—É (–ì—Ä–∞–¥—ñ—î–Ω—Ç)</span>
            <span class="admin-label">–ö–æ–ª—ñ—Ä –í–µ—Ä—Ö / –ù–∏–∑:</span>
            <div class="admin-row">
                <input type="color" id="site-color-top" value="#059669">
                <input type="color" id="site-color-bot" value="#2563eb">
            </div>
            <span class="admin-label">–ö—É—Ç (deg):</span>
            <input type="number" id="site-gradient-angle" value="135" min="0" max="360" step="5">
        </div>
        <span class="admin-label mt-6">–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤</span>
        <button class="btn-tool" id="add-card-struct">üìÑ + –ö–∞—Ä—Ç–∫–∞</button>
        <button class="btn-tool" id="add-float-text">üí¨ + –¢–µ–∫—Å—Ç</button>
        <button class="btn-tool" id="add-float-img">üñºÔ∏è + –ö–∞—Ä—Ç–∏–Ω–∫–∞</button>
        <button class="btn-tool" id="add-hero-banner">üì¢ + –ë–∞–Ω–µ—Ä (Hero)</button>
        <div id="style-controls">
            <span class="admin-label text-yellow-400">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä</span>
            <span class="admin-label">–†–æ–∑–º—ñ—Ä (px):</span>
            <input type="number" id="font-size-input" value="16">
            <span class="admin-label">–®—Ä–∏—Ñ—Ç:</span>
            <select id="font-select"></select>
            <span class="admin-label">–ö–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É:</span>
            <input type="color" id="color-text">
            <span class="admin-label">–§–æ–Ω:</span>
            <div style="display: flex; gap: 5px;">
                <input type="color" id="color-bg" value="#ffffff">
                <button class="btn-tool" style="width: auto; margin: 5px 0 0;" id="btn-no-bg">X</button>
            </div>
            <div id="card-style-controls">
                <span class="admin-label text-purple-400">‚ú® –ì—Ä–∞–¥—ñ—î–Ω—Ç –ö–∞—Ä—Ç–∫–∏</span>
                <span class="admin-label">–í–µ—Ä—Ö–Ω—ñ–π –∫–æ–ª—ñ—Ä:</span>
                <input type="color" id="card-color-top" value="#667eea">
                <span class="admin-label">–ù–∏–∂–Ω—ñ–π –∫–æ–ª—ñ—Ä:</span>
                <input type="color" id="card-color-bot" value="#764ba2">
                <span class="admin-label">–ö–∞—Ä—Ç–∏–Ω–∫–∞ (URL):</span>
                <input type="text" id="card-img-url" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏...">
            </div>
            <div id="hero-style-controls">
                <span class="admin-label text-red-400">üî• –ë–∞–Ω–µ—Ä –ì—Ä–∞–¥—ñ—î–Ω—Ç</span>
                <span class="admin-label">–õ—ñ–≤–æ / –ü—Ä–∞–≤–æ:</span>
                <div class="admin-row">
                    <input type="color" id="hero-grad-top" value="#42a5f5">
                    <input type="color" id="hero-grad-bot" value="#26a69a">
                </div>
                <span class="admin-label">–ö–∞—Ä—Ç–∏–Ω–∫–∞ –∑–≤–µ—Ä—Ö—É (URL):</span>
                <input type="text" id="hero-img-url" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏...">
            </div>
            <button class="btn-tool" style="background: #c0392b; margin-top: 20px;" id="btn-delete">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
        </div>
        <button class="btn-tool" style="background: #7f8c8d; margin-top: 30px;" onclick="toggleAdmin(false)">–ó–∞–∫—Ä–∏—Ç–∏</button>
    </div>

    <footer class="bg-white dark:bg-gray-900 border-t dark:border-gray-800 mt-auto text-center transition-colors duration-300 py-12">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-center space-x-2 mb-6">
                <i class="fas fa-route text-green-500"></i>
                <span class="text-xl font-bold text-gray-900 dark:text-white">Nutriway</span>
            </div>
            <p class="text-gray-400 dark:text-gray-600 text-[10px] font-bold uppercase tracking-[0.2em] editable-text">¬© 2025 –í—Å—ñ –ø—Ä–∞–≤–∞ –∑–∞—Ö–∏—â–µ–Ω—ñ</p>
        </div>
    </footer>

    <script>
        // --- THEME LOGIC START ---
        const themeBtn = document.getElementById('theme-toggle');
        const themeIcon = themeBtn.querySelector('i');
        const htmlEl = document.documentElement;

        function applyTheme(isDark) {
            if (isDark) {
                htmlEl.classList.add('dark');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                htmlEl.classList.remove('dark');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
        }

        // Init Check
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            applyTheme(true);
        } else {
            applyTheme(false);
        }

        themeBtn.addEventListener('click', () => {
            if (htmlEl.classList.contains('dark')) {
                localStorage.theme = 'light';
                applyTheme(false);
            } else {
                localStorage.theme = 'dark';
                applyTheme(true);
            }
        });
        // --- THEME LOGIC END ---

        // --- 1. NAV LOGIC ---
        function toggleMenu() {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('menu-overlay');
            const icon = document.getElementById('menu-icon');
            if (menu.classList.contains('active')) {
                menu.classList.remove('active');
                overlay.classList.remove('active');
                icon.className = "fas fa-bars text-2xl";
                document.body.style.overflow = "auto";
            } else {
                menu.classList.add('active');
                overlay.classList.add('active');
                icon.className = "fas fa-times text-2xl";
                document.body.style.overflow = "hidden";
            }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p => p.classList.remove('active'));
            const page = document.getElementById(pageId + '-page');
            if(page) page.classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- 2. CALCULATOR LOGIC ---
        let ReTryBut = 0;

        function clearResult(){
          document.getElementById('confirm-buttons').classList.add('hidden');
          document.getElementById('resultArea').classList.add('hidden');
          document.getElementById('vitamin-section').classList.add('hidden');
          document.getElementById('macros-section').classList.add('hidden');
          document.getElementById('sleep-section').classList.add('hidden');
          document.getElementById('water-section').classList.add('hidden');
        }
      
        function reTry(){
          ReTryBut=0;
          clearResult();
        }

        function IMT(){
            const height = Number(document.getElementById('height').value);
            const weight = Number(document.getElementById('weight').value);
            if(!height||!weight) return NaN;
            return Number((weight/((height/100)**2)).toFixed(2));
        }

        function IMT_Interpretation(imt_value){
            if(!isFinite(imt_value)) return '–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö';
            if(imt_value<16) return '–í–∏—Ä–∞–∂–µ–Ω–∏–π –¥–µ—Ñ—ñ—Ü–∏—Ç';
            if(imt_value<18.5) return '–î–µ—Ñ—ñ—Ü–∏—Ç –≤–∞–≥–∏';
            if(imt_value<25) return '–ù–æ—Ä–º–∞';
            if(imt_value<30) return '–ü—Ä–µ–¥–æ–∂–∏—Ä—ñ–Ω–Ω—è';
            return '–û–∂–∏—Ä—ñ–Ω–Ω—è';
        }

        function BMR(age,height,weight,gender,activity){
            age=Number(age);height=Number(height);weight=Number(weight);
            const multipliers={very_high:1.9,high:1.725,medium:1.55,small:1.375,low:1.2};
            let bmr = (10*weight)+(6.25*height)-(5*age)+(gender==='male'?5:-161);
            return bmr*(multipliers[activity]??1.55);
        }

        function proteins(activity,weight){const m={very_high:2,high:1.8,medium:1.4,small:1.2,low:0.8}; return Number(weight)*(m[activity]??1.4)}
        function fat(brm_last){return (0.3*brm_last)/9}
        function carb(brm_last){return (0.4*brm_last)/4}

        function vitamins(age,gender,weight,activity){
            age=Number(age);weight=Number(weight);
            const multipliers={very_high:1.4,high:1.2,medium:1.1,small:1,low:0.8};
            const vitaminRDA={Vitamin_C:90,Vitamin_D:800,Vitamin_A:700,Vitamin_B1:1.1,Vitamin_B6:1.3,Vitamin_B12:2.4};
            const genderFactor={male:1,female:0.9};
            let ageFactor = age<=3?0.8:age<=8?0.9:age<=13?1:age<=18?1.1:age<=50?1:1.2;
            const activityMultiplier = multipliers[activity] ?? 1.1;
            const gFactor = genderFactor[gender] ?? 1;
            const weightFactor = (weight>0)?(weight/70):1;
            return {
            Vitamin_D: vitaminRDA.Vitamin_D * ageFactor * gFactor * activityMultiplier * weightFactor,
            Vitamin_C: vitaminRDA.Vitamin_C * ageFactor * gFactor * activityMultiplier * weightFactor,
            Vitamin_B12: vitaminRDA.Vitamin_B12 * ageFactor * gFactor * activityMultiplier * weightFactor,
            Vitamin_A: vitaminRDA.Vitamin_A * ageFactor * gFactor * activityMultiplier * weightFactor,
            Vitamin_B1: vitaminRDA.Vitamin_B1 * ageFactor * gFactor * activityMultiplier * weightFactor,
            Vitamin_B6: vitaminRDA.Vitamin_B6 * ageFactor * gFactor * activityMultiplier * weightFactor
            };
        }

        function getSleepRecommendation(age) {
            if (age >= 1 && age <= 2) return "13 –≥–æ–¥–∏–Ω";
            if (age >= 3 && age <= 5) return "12 –≥–æ–¥–∏–Ω";
            if (age >= 6 && age <= 13) return "10 –≥–æ–¥–∏–Ω";
            if (age >= 14 && age <= 17) return "9 –≥–æ–¥–∏–Ω";
            if (age >= 18 && age <= 25) return "8 –≥–æ–¥–∏–Ω";
            if (age >= 26 && age <= 64) return "8 –≥–æ–¥–∏–Ω";
            if (age >= 65) return "7 –≥–æ–¥–∏–Ω";
            if (age < 1 && age >= 0) return "14-17 –≥–æ–¥–∏–Ω (–Ω–µ–º–æ–≤–ª—è—Ç–∞)";
            return "8 –≥–æ–¥–∏–Ω";
        }

        function getWaterRecommendation(weight) {
            const water = weight * 0.033;
            return water.toFixed(2) + " –ª—ñ—Ç—Ä—ñ–≤";
        }

        function showData(){
            const ageRaw = document.getElementById('age').value;
            const heightRaw = document.getElementById('height').value;
            const weightRaw = document.getElementById('weight').value;
            const allergy = document.getElementById('allergy').value; 
            const health = document.getElementById('health').value;   

            const age = Number(ageRaw), height = Number(heightRaw), weight = Number(weightRaw);
            const gender = document.querySelector('input[name="gender"]:checked')?.value || 'male';
            const activity = document.querySelector('input[name="activity"]:checked')?.value || 'medium';
            
            if(!ageRaw||!heightRaw||!weightRaw){
                document.getElementById('resultArea').classList.remove('hidden');
                document.getElementById('text-info').innerText='–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!';
                document.getElementById('macros-section').classList.remove('hidden');
                return;
            }

            if(((age>100||height>210||weight>200)||(age<=1||height<=35||weight<=2)) && ReTryBut==0){
                document.getElementById('resultArea').classList.remove('hidden');
                document.getElementById('macros-section').classList.remove('hidden');
                document.getElementById('text-info').innerText='–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ —É –¥–∞–Ω–∏—Ö? –ó–Ω–∞—á–µ–Ω–Ω—è –≤–∏–≥–ª—è–¥–∞—é—Ç—å –ø—ñ–¥–æ–∑—Ä—ñ–ª–æ.';
                document.getElementById('confirm-buttons').classList.remove('hidden');
                ReTryBut=1; 
                return;
            }

            ReTryBut=0;
            document.getElementById('confirm-buttons').classList.add('hidden');
            document.getElementById('resultArea').classList.remove('hidden');

            try{
                const bmrVal = BMR(age,height,weight,gender,activity);
                const imtVal = IMT();
                const sleepRec = getSleepRecommendation(age);
                const waterRec = getWaterRecommendation(weight);

                const calVal = Number(bmrVal).toFixed(0);
                const protVal = Number(proteins(activity,weight)).toFixed(0);
                const fatVal = Number(fat(bmrVal)).toFixed(0);
                const carbVal = Number(carb(bmrVal)).toFixed(0);

                const macrosHTML = `
                    <div class="flex flex-col items-center p-4 bg-orange-50 dark:bg-orange-900/20 rounded-2xl border border-orange-100 dark:border-orange-900/30">
                        <div class="text-orange-500 text-2xl mb-2"><i class="fas fa-fire"></i></div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 font-bold uppercase">–ö–∞–ª–æ—Ä—ñ—ó</div>
                        <div class="text-lg font-bold text-gray-900 dark:text-white">${calVal}</div>
                    </div>
                    <div class="flex flex-col items-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-2xl border border-blue-100 dark:border-blue-900/30">
                        <div class="text-blue-500 text-2xl mb-2"><i class="fas fa-dumbbell"></i></div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 font-bold uppercase">–ë—ñ–ª–∫–∏</div>
                        <div class="text-lg font-bold text-gray-900 dark:text-white">${protVal} –≥</div>
                    </div>
                    <div class="flex flex-col items-center p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-2xl border border-yellow-100 dark:border-yellow-900/30">
                        <div class="text-yellow-500 text-2xl mb-2"><i class="fas fa-tint"></i></div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 font-bold uppercase">–ñ–∏—Ä–∏</div>
                        <div class="text-lg font-bold text-gray-900 dark:text-white">${fatVal} –≥</div>
                    </div>
                    <div class="flex flex-col items-center p-4 bg-green-50 dark:bg-green-900/20 rounded-2xl border border-green-100 dark:border-green-900/30">
                        <div class="text-green-500 text-2xl mb-2"><i class="fas fa-bread-slice"></i></div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 font-bold uppercase">–í—É–≥–ª–µ–≤–æ–¥–∏</div>
                        <div class="text-lg font-bold text-gray-900 dark:text-white">${carbVal} –≥</div>
                    </div>
                `;
                document.getElementById('macros-grid-container').innerHTML = macrosHTML;
                document.getElementById('macros-section').classList.remove('hidden');

                // --- NEW IMT LOGIC ---
                const imtStatus = IMT_Interpretation(imtVal);
                let statusColorClass = 'text-gray-700';
                let statusBgClass = 'bg-gray-100';

                // –í–∏–±—ñ—Ä –∫–æ–ª—å–æ—Ä—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è –Ü–ú–¢
                if (imtVal < 18.5) {
                    // –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—è –≤–∞–≥–∞ - –°–∏–Ω—ñ–π
                    statusColorClass = 'text-blue-600';
                    statusBgClass = 'bg-blue-100 dark:bg-blue-900/30';
                } else if (imtVal < 25) {
                    // –ù–æ—Ä–º–∞ - –ó–µ–ª–µ–Ω–∏–π
                    statusColorClass = 'text-green-600';
                    statusBgClass = 'bg-green-100 dark:bg-green-900/30';
                } else if (imtVal < 30) {
                    // –ü—Ä–µ–¥–æ–∂–∏—Ä—ñ–Ω–Ω—è - –ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π
                    statusColorClass = 'text-orange-500';
                    statusBgClass = 'bg-orange-100 dark:bg-orange-900/30';
                } else {
                    // –û–∂–∏—Ä—ñ–Ω–Ω—è - –ß–µ—Ä–≤–æ–Ω–∏–π
                    statusColorClass = 'text-red-600';
                    statusBgClass = 'bg-red-100 dark:bg-red-900/30';
                }

                document.getElementById('imt-display').innerHTML = `
                    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4">
                        <span class="text-xl font-bold dark:text-gray-200">–Ü–ú–¢: <span class="text-2xl">${imtVal}</span></span>
                        <span class="px-4 py-2 rounded-xl font-bold border ${statusColorClass} ${statusBgClass} border-current shadow-sm transition-all duration-300">
                            ${imtStatus}
                        </span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-3 mt-4 dark:bg-gray-700 overflow-hidden shadow-inner">
                         <!-- –õ—ñ–Ω—ñ—è –ø—Ä–æ–≥—Ä–µ—Å—É (–º–∞–∫—Å 100% —à–∏—Ä–∏–Ω–∏, scale –Ω–∞ 40, –±–æ –Ü–ú–¢ > 40 —Ü–µ –≤–∂–µ –±–∞–≥–∞—Ç–æ) -->
                        <div class="h-3 rounded-full transition-all duration-1000 ease-out ${statusColorClass.replace('text-', 'bg-')}" style="width: ${Math.min((imtVal / 40) * 100, 100)}%"></div>
                    </div>
                `;
                // --- END NEW IMT LOGIC ---

                let extraInfo = '';
                if(allergy) extraInfo += `–ê–ª–µ—Ä–≥—ñ—ó: ${allergy}\n`;
                if(health) extraInfo += `–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –∑–¥–æ—Ä–æ–≤'—è: ${health}`;
                document.getElementById('text-info').innerText = extraInfo;

                document.getElementById('sleep-value').innerText = sleepRec;
                document.getElementById('sleep-section').classList.remove('hidden');

                document.getElementById('water-value').innerText = waterRec;
                document.getElementById('water-section').classList.remove('hidden');

                const vitaminInfo = {
                    Vitamin_C:  { name: "–í—ñ—Ç–∞–º—ñ–Ω C", unit: "–º–≥", icon: "lemon", color: "text-orange-500", desc: "–ó–º—ñ—Ü–Ω—é—î —ñ–º—É–Ω—ñ—Ç–µ—Ç, –¥–æ–ø–æ–º–∞–≥–∞—î –∑–∞–≥–æ—î–Ω–Ω—é —Ä–∞–Ω, –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –¥–ª—è —Å—É–¥–∏–Ω —ñ –∑–∞—Å–≤–æ—î–Ω–Ω—è –∑–∞–ª—ñ–∑–∞" },
                    Vitamin_D:  { name: "–í—ñ—Ç–∞–º—ñ–Ω D", unit: "IU", icon: "sun", color: "text-yellow-500", desc: "–†–µ–≥—É–ª—é—î –∑–∞—Å–≤–æ—î–Ω–Ω—è –∫–∞–ª—å—Ü—ñ—é —ñ —Ñ–æ—Å—Ñ–æ—Ä—É, –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –¥–ª—è –º—ñ—Ü–Ω–∏—Ö –∫—ñ—Å—Ç–æ–∫ —Ç–∞ —ñ–º—É–Ω—ñ—Ç–µ—Ç—É" },
                    Vitamin_A:  { name: "–í—ñ—Ç–∞–º—ñ–Ω A", unit: "–º–∫–≥", icon: "eye", color: "text-green-500", desc: "–ó–∞–±–µ–∑–ø–µ—á—É—î –Ω–æ—Ä–º–∞–ª—å–Ω–∏–π –∑—ñ—Ä, —Ä—ñ—Å—Ç –∫–ª—ñ—Ç–∏–Ω —ñ –∑–¥–æ—Ä–æ–≤‚Äô—è —à–∫—ñ—Ä–∏ —Ç–∞ —Å–ª–∏–∑–æ–≤–∏—Ö –æ–±–æ–ª–æ–Ω–æ–∫" },
                    Vitamin_B1: { name: "–í—ñ—Ç–∞–º—ñ–Ω B1", unit: "–º–≥", icon: "bolt", color: "text-red-500", desc: "–ù–µ–æ–±—Ö—ñ–¥–Ω–∏–π –¥–ª—è —Ä–æ–±–æ—Ç–∏ –Ω–µ—Ä–≤–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —ó–∂—ñ –Ω–∞ –µ–Ω–µ—Ä–≥—ñ—é" },
                    Vitamin_B6: { name: "–í—ñ—Ç–∞–º—ñ–Ω B6", unit: "–º–≥", icon: "capsules", color: "text-purple-500", desc: "–ë–µ—Ä–µ —É—á–∞—Å—Ç—å —É –æ–±–º—ñ–Ω—ñ –±—ñ–ª–∫—ñ–≤, —Ä–æ–±–æ—Ç—ñ –º–æ–∑–∫—É —Ç–∞ —É—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –≥–µ–º–æ–≥–ª–æ–±—ñ–Ω—É" },
                    Vitamin_B12:{ name: "–í—ñ—Ç–∞–º—ñ–Ω B12", unit: "–º–∫–≥", icon: "brain", color: "text-pink-500", desc: "–í–∞–∂–ª–∏–≤–∏–π –¥–ª—è –∫—Ä–æ–≤–æ—Ç–≤–æ—Ä–µ–Ω–Ω—è, –Ω–µ—Ä–≤–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ —Å–∏–Ω—Ç–µ–∑—É –î–ù–ö" }
                };
                
                const vitaminValues = vitamins(age, gender, weight, activity);
                const gridContainer = document.getElementById('vitamin-grid-container');
                
                let cardsHTML = '';
                for (const key in vitaminValues) {
                    const val = vitaminValues[key];
                    const info = vitaminInfo[key];
                    cardsHTML += `
                        <div class="vit-item bg-gray-50 dark:bg-gray-700/50 dark:border-gray-600 border border-gray-100 transition-colors duration-300">
                            <div class="vit-icon-box ${info.color}"><i class="fas fa-${info.icon}"></i></div>
                            <div>
                                <h5 class="font-bold text-sm text-gray-800 dark:text-gray-100">${info.name}</h5>
                                <p class="font-bold text-gray-900 dark:text-white">${val.toFixed(2)} ${info.unit}</p>
                                <h6 class="text-xs text-gray-500 dark:text-gray-400 mt-1">${info.desc}</h6>
                            </div>
                        </div>`;
                }
                gridContainer.innerHTML = cardsHTML;
                document.getElementById('vitamin-section').classList.remove('hidden');

            } catch(err){ console.error(err); }
        }

        // --- 3. ADMIN PANEL LOGIC ---
        let isAdmin = false;
        let selectedElement = null;
        let isDragging = false;
        let isResizing = false;
        let startX, startY, startLeft, startTop, startWidth, startHeight;
        
        const historyStack = [];
        let historyIndex = -1;

        function openAdminAuth() {
            setTimeout(() => {
                const pass = prompt("–ü–∞—Ä–æ–ª—å:", "Admin_GPT");
                if (pass === "Admin_GPT") toggleAdmin(true);
                else alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å");
            }, 100);
        }

        function toggleAdmin(active) {
            isAdmin = active;
            const panel = document.getElementById('admin-panel');
            if (active) {
                panel.classList.add('active');
                if (historyStack.length === 0) saveState();
                updateSiteControls();
            } else {
                panel.classList.remove('active');
                deselect();
            }
        }

        function saveState() {
            if (!isAdmin) return;
            const content = document.getElementById('content-area').innerHTML;
            const rootStyle = getComputedStyle(document.documentElement);
            const siteStyles = {
                '--site-color-top': rootStyle.getPropertyValue('--site-color-top'),
                '--site-color-bot': rootStyle.getPropertyValue('--site-color-bot'),
                '--site-gradient-angle': rootStyle.getPropertyValue('--site-gradient-angle')
            };
            historyStack.push({ content, siteStyles });
            historyIndex++;
        }

        function updateSiteGradient() {
            const top = document.getElementById('site-color-top').value;
            const bot = document.getElementById('site-color-bot').value;
            const angle = document.getElementById('site-gradient-angle').value;
            
            document.documentElement.style.setProperty('--site-color-top', top);
            document.documentElement.style.setProperty('--site-color-bot', bot);
            document.documentElement.style.setProperty('--site-gradient-angle', angle + 'deg');
        }

        function updateSiteControls() {
            const style = getComputedStyle(document.documentElement);
            document.getElementById('site-color-top').value = style.getPropertyValue('--site-color-top').trim();
            document.getElementById('site-color-bot').value = style.getPropertyValue('--site-color-bot').trim();
        }

        document.getElementById('site-color-top').oninput = updateSiteGradient;
        document.getElementById('site-color-bot').oninput = updateSiteGradient;
        document.getElementById('site-gradient-angle').oninput = updateSiteGradient;

        document.getElementById('add-card-struct').onclick = () => {
            let grid = document.querySelector('.page-content.active .grid');
            if (!grid) grid = document.getElementById('diag-grid');
            if (!grid) { alert("–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Å—ñ—Ç–∫–∏ (grid)."); return; }

            const card = document.createElement('div');
            card.className = 'card'; 
            card.style.setProperty('--card-color-top', '#667eea');
            card.style.setProperty('--card-color-bot', '#764ba2');
            
            card.innerHTML = `
                <img src="https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=500&auto=format&fit=crop" class="card-image" alt="New">
                <div class="card-content">
                    <h2 class="editable-text">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h2>
                    <p class="editable-text">–í–∞—à –æ–ø–∏—Å —Ç—É—Ç.</p>
                </div>
            `;
            grid.appendChild(card);
            saveState();
        };

        document.getElementById('add-hero-banner').onclick = () => createMovableElement('hero', '');
        document.getElementById('add-float-text').onclick = () => createMovableElement('text', '–í–∞—à —Ç–µ–∫—Å—Ç');
        document.getElementById('add-float-img').onclick = () => {
            const url = prompt("URL:", "https://source.unsplash.com/random/200x200");
            if(url) createMovableElement('img', url);
        };

        function createMovableElement(type, content) {
            const container = document.querySelector('.page-content.active .container') || document.body;
            const box = document.createElement('div');
            box.className = 'movable-box';
            box.style.left = '50px'; box.style.top = '100px';
            
            const inner = document.createElement('div');
            inner.className = 'movable-content';

            if (type === 'text') {
                inner.innerText = content;
                inner.style.padding = '10px';
                inner.style.background = 'white';
                inner.classList.add('editable-text');
                box.style.width = '200px';
            } else if (type === 'img') {
                const img = document.createElement('img');
                img.src = content; img.style.width='100%'; img.style.height='100%';
                inner.appendChild(img);
                box.style.width = '200px'; box.style.height = '200px';
            } else if (type === 'hero') {
                box.style.width = '100%'; box.style.maxWidth = '800px'; box.style.height = '250px';
                inner.classList.add('hero-banner-style'); 
                inner.innerHTML = `
                    <img src="" class="hero-banner-img" style="display: none;">
                    <h2 class="editable-text text-2xl font-bold">–ó–¥–æ—Ä–æ–≤–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è</h2>
                    <p class="editable-text">–í–∞—à —à–ª—è—Ö –¥–æ —ñ–¥–µ–∞–ª—å–Ω–æ—ó —Ñ–æ—Ä–º–∏.</p>
                `;
            }
            
            const handle = document.createElement('div');
            handle.className = 'resize-handle';
            box.appendChild(inner); box.appendChild(handle);
            container.appendChild(box);
            selectElement(box);
            saveState();
        }

        function selectElement(el) {
            if(selectedElement && selectedElement !== el) deselect();
            selectedElement = el;
            
            document.querySelectorAll('.selected-element').forEach(e => e.classList.remove('selected-element'));
            el.classList.add('selected-element');
            document.getElementById('style-controls').classList.add('active');

            document.getElementById('card-style-controls').style.display = 'none';
            document.getElementById('hero-style-controls').style.display = 'none';

            if (el.classList.contains('card')) {
                document.getElementById('card-style-controls').style.display = 'block';
                const topVal = el.style.getPropertyValue('--card-color-top') || '#667eea';
                const botVal = el.style.getPropertyValue('--card-color-bot') || '#764ba2';
                document.getElementById('card-color-top').value = rgbToHex(topVal.trim());
                document.getElementById('card-color-bot').value = rgbToHex(botVal.trim());
                const img = el.querySelector('img');
                if(img) document.getElementById('card-img-url').value = img.src;
            }

            if (el.classList.contains('movable-box') && el.querySelector('.hero-banner-style')) {
                document.getElementById('hero-style-controls').style.display = 'block';
                const heroInner = el.querySelector('.hero-banner-style');
                const hTop = heroInner.style.getPropertyValue('--hero-bg-top') || '#42a5f5';
                const hBot = heroInner.style.getPropertyValue('--hero-bg-bot') || '#26a69a';
                document.getElementById('hero-grad-top').value = rgbToHex(hTop.trim());
                document.getElementById('hero-grad-bot').value = rgbToHex(hBot.trim());
                const heroImg = heroInner.querySelector('.hero-banner-img');
                if (heroImg && heroImg.src && heroImg.style.display !== 'none') {
                    document.getElementById('hero-img-url').value = heroImg.src;
                } else {
                    document.getElementById('hero-img-url').value = '';
                }
            }
        }

        function deselect() {
            if (selectedElement) {
                selectedElement.classList.remove('selected-element');
                if (selectedElement.isContentEditable) selectedElement.contentEditable = "false";
                selectedElement = null;
                document.getElementById('style-controls').classList.remove('active');
            }
        }

        function initFonts() {
            const fonts = ["Montserrat", "Roboto", "Open Sans", "Oswald", "Pacifico", "Lobster", "Comfortaa", "Arial", "Inter", "Poppins", "Lato", "Nunito", "Raleway", "Ubuntu", "Bebas Neue", "Anton", "Playfair Display", "Cinzel", "Dancing Script", "Great Vibes", "Indie Flower"];
            const sel = document.getElementById('font-select');
            fonts.forEach(f => {
                const opt = document.createElement('option');
                opt.value = f; opt.innerText = f;
                sel.appendChild(opt);
            });
        }
        initFonts();

        function rgbToHex(rgb) {
            if(!rgb || rgb.includes('rgba(0, 0, 0, 0)') || rgb === 'transparent') return "#ffffff";
            if(rgb.startsWith('#')) return rgb;
            let sep = rgb.indexOf(",") > -1 ? "," : " ";
            let rgbArr = rgb.substr(4).split(")")[0].split(sep);
            if (rgbArr.length === 4) rgbArr.pop();
            let r = (+rgbArr[0]).toString(16), g = (+rgbArr[1]).toString(16), b = (+rgbArr[2]).toString(16);
            if(r.length==1)r="0"+r; if(g.length==1)g="0"+g; if(b.length==1)b="0"+b;
            return "#" + r + g + b;
        }

        document.addEventListener('mousedown', (e) => {
            if (!isAdmin) return;
            const target = e.target;
            if (target.closest('#admin-panel')) return;

            // 1. –°–ø–æ—á–∞—Ç–∫—É –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ resize (—â–æ–± –ø—Ä–∞—Ü—é–≤–∞–ª–æ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É –µ–ª–µ–º–µ–Ω—Ç—ñ)
            if (target.classList.contains('resize-handle')) {
                e.preventDefault(); e.stopPropagation(); isResizing = true;
                selectedElement = target.parentElement;
                startX = e.clientX; startY = e.clientY;
                startWidth = selectedElement.offsetWidth; startHeight = selectedElement.offsetHeight;
                return;
            }

            // 2. –ü–û–¢–Ü–ú –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç–µ–∫—Å—Ç (—Ü–µ –¥–æ–∑–≤–æ–ª—è—î —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç –í–°–ï–†–ï–î–ò–ù–Ü –∫–∞—Ä—Ç–æ–∫)
            if (target.classList.contains('editable-text')) {
                 selectElement(target); 
                 target.contentEditable = "true"; 
                 target.focus(); 
                 return; // –í–∏—Ö–æ–¥–∏–º–æ, —â–æ–± –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤ drag/drop –±–∞—Ç—å–∫—ñ–≤—Å—å–∫–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
            }

            // 3. –†—É—Ö–æ–º—ñ –±–æ–∫—Å–∏
            const box = target.closest('.movable-box');
            if (box) {
                e.preventDefault(); selectElement(box); isDragging = true;
                startX = e.clientX; startY = e.clientY;
                startLeft = box.offsetLeft; startTop = box.offsetTop;
                return;
            }

            // 4. –ö–∞—Ä—Ç–∫–∏
            const card = target.closest('.card');
            if(card) { 
                e.preventDefault(); selectElement(card); return; 
            }

            deselect();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isAdmin) return;
            if (isDragging && selectedElement) {
                const dx = e.clientX - startX; const dy = e.clientY - startY;
                selectedElement.style.left = (startLeft + dx) + 'px';
                selectedElement.style.top = (startTop + dy) + 'px';
            }
            if (isResizing && selectedElement) {
                const dx = e.clientX - startX; const dy = e.clientY - startY;
                selectedElement.style.width = (startWidth + dx) + 'px';
                selectedElement.style.height = (startHeight + dy) + 'px';
            }
        });

        document.addEventListener('mouseup', () => { isDragging = false; isResizing = false; });

        function applyStyle(prop, val) {
            if (!selectedElement) return;
            let target = selectedElement;
            if (selectedElement.classList.contains('movable-box')) target = selectedElement.querySelector('.movable-content');
            target.style[prop] = val;
        }

        function updateCSSVar(el, varName, val) { if(!el) return; el.style.setProperty(varName, val); }

        document.getElementById('color-text').oninput = (e) => applyStyle('color', e.target.value);
        document.getElementById('font-size-input').onchange = (e) => applyStyle('fontSize', e.target.value + 'px');
        document.getElementById('font-select').onchange = (e) => applyStyle('fontFamily', e.target.value);
        document.getElementById('color-bg').oninput = (e) => applyStyle('backgroundColor', e.target.value);
        document.getElementById('btn-no-bg').onclick = () => { document.getElementById('color-bg').value='#000000'; applyStyle('backgroundColor', 'transparent'); }
        document.getElementById('btn-delete').onclick = () => { if(selectedElement) selectedElement.remove(); deselect(); };

        document.getElementById('card-color-top').oninput = (e) => updateCSSVar(selectedElement, '--card-color-top', e.target.value);
        document.getElementById('card-color-bot').oninput = (e) => updateCSSVar(selectedElement, '--card-color-bot', e.target.value);
        document.getElementById('card-img-url').oninput = (e) => {
            if (!selectedElement || !selectedElement.classList.contains('card')) return;
            const img = selectedElement.querySelector('img');
            if(img && e.target.value.trim() !== "") img.src = e.target.value;
        };

        document.getElementById('hero-grad-top').oninput = (e) => {
            const inner = selectedElement.querySelector('.hero-banner-style');
            updateCSSVar(inner, '--hero-bg-top', e.target.value);
        };
        document.getElementById('hero-grad-bot').oninput = (e) => {
            const inner = selectedElement.querySelector('.hero-banner-style');
            updateCSSVar(inner, '--hero-bg-bot', e.target.value);
        };
        document.getElementById('hero-img-url').oninput = (e) => {
            const inner = selectedElement.querySelector('.hero-banner-style');
            if (!inner) return;
            let img = inner.querySelector('.hero-banner-img');
            if (e.target.value.trim() !== "") {
                img.src = e.target.value; img.style.display = 'block';
            } else { img.style.display = 'none'; }
        };
        function closeDisclaimer() {
            const overlay = document.getElementById('disclaimer-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 500);
        }
    </script>
</body>
</html>